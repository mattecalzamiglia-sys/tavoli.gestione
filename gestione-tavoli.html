<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@_muse.in_ - Gestione Tavoli</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        body { margin: 0; padding: 0; font-family: system-ui, -apple-system, sans-serif; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(100,100,100,0.1); }
        ::-webkit-scrollbar-thumb { background: rgba(168,85,247,0.5); border-radius: 4px; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script>
        // Firebase init
        firebase.initializeApp({
            apiKey: "AIzaSyA-m6tX87TZtqTDg2kuE04zDvxkJ_vH2Yg",
            authDomain: "gestionale-discoteche-2026.firebaseapp.com",
            projectId: "gestionale-discoteche-2026",
            storageBucket: "gestionale-discoteche-2026.firebasestorage.app",
            messagingSenderId: "299126578946",
            appId: "1:299126578946:web:2609823671a0eed056ac1b"
        });
        const db = firebase.firestore();

        const { useState, useEffect, useRef } = React;
        const h = React.createElement;

        // Icons as functions
        const Icon = (path, size=24) => h('svg', {xmlns:'http://www.w3.org/2000/svg',width:size,height:size,viewBox:'0 0 24 24',fill:'none',stroke:'currentColor',strokeWidth:2,strokeLinecap:'round',strokeLinejoin:'round'}, h('path',{d:path}));
        const PlusIcon = (s) => h('svg',{xmlns:'http://www.w3.org/2000/svg',width:s||24,height:s||24,viewBox:'0 0 24 24',fill:'none',stroke:'currentColor',strokeWidth:2},h('path',{d:'M5 12h14'}),h('path',{d:'M12 5v14'}));
        const UsersIcon = (s) => h('svg',{xmlns:'http://www.w3.org/2000/svg',width:s||24,height:s||24,viewBox:'0 0 24 24',fill:'none',stroke:'currentColor',strokeWidth:2},h('path',{d:'M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2'}),h('circle',{cx:9,cy:7,r:4}),h('path',{d:'M22 21v-2a4 4 0 0 0-3-3.87'}),h('path',{d:'M16 3.13a4 4 0 0 1 0 7.75'}));
        const XIcon = (s) => h('svg',{xmlns:'http://www.w3.org/2000/svg',width:s||24,height:s||24,viewBox:'0 0 24 24',fill:'none',stroke:'currentColor',strokeWidth:2},h('path',{d:'M18 6 6 18'}),h('path',{d:'M6 6l12 12'}));
        const TrashIcon = (s) => h('svg',{xmlns:'http://www.w3.org/2000/svg',width:s||24,height:s||24,viewBox:'0 0 24 24',fill:'none',stroke:'currentColor',strokeWidth:2},h('path',{d:'M3 6h18'}),h('path',{d:'M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6'}),h('path',{d:'M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2'}));
        const ChevronLeftIcon = (s) => h('svg',{xmlns:'http://www.w3.org/2000/svg',width:s||24,height:s||24,viewBox:'0 0 24 24',fill:'none',stroke:'currentColor',strokeWidth:2},h('path',{d:'m15 18-6-6 6-6'}));

        function App() {
            const [events, setEvents] = useState([]);
            const [currentEvent, setCurrentEvent] = useState(null);
            const [tables, setTables] = useState([]);
            const [bookings, setBookings] = useState([]);
            const [prs, setPrs] = useState([]);
            const [guestLists, setGuestLists] = useState([]);
            const [menu, setMenu] = useState([]);
            const [orders, setOrders] = useState([]);
            const [waiterCalls, setWaiterCalls] = useState([]);
            const [inventory, setInventory] = useState([]);
            const [staff, setStaff] = useState([]);
            const [loading, setLoading] = useState(true);
            const [view, setView] = useState('tables'); // tables, prs, orders, inventory, staff
            const [showNewEvent, setShowNewEvent] = useState(false);
            const [showNewPr, setShowNewPr] = useState(false);
            const [showFullGuestList, setShowFullGuestList] = useState(false);
            const [selectedPr, setSelectedPr] = useState(null);
            const [selectedTable, setSelectedTable] = useState(null);
            const [editMode, setEditMode] = useState(false);
            const unsubs = useRef([]);

            // Load events on mount
            useEffect(() => {
                const unsub = db.collection('events').onSnapshot(snap => {
                    setEvents(snap.docs.map(d => ({id: d.id, ...d.data()})));
                    setLoading(false);
                });
                return () => unsub();
            }, []);

            // Setup listeners when event selected
            useEffect(() => {
                if (!currentEvent) return;
                unsubs.current.forEach(u => u());
                unsubs.current = [];

                const eid = currentEvent.id;
                unsubs.current.push(db.collection('events').doc(eid).collection('tables').onSnapshot(s => setTables(s.docs.map(d => ({id:d.id,...d.data()})))));
                unsubs.current.push(db.collection('events').doc(eid).collection('bookings').onSnapshot(s => setBookings(s.docs.map(d => ({id:d.id,...d.data()})))));
                unsubs.current.push(db.collection('events').doc(eid).collection('prs').onSnapshot(s => setPrs(s.docs.map(d => ({id:d.id,...d.data()})))));
                unsubs.current.push(db.collection('events').doc(eid).collection('guestLists').onSnapshot(s => setGuestLists(s.docs.map(d => ({id:d.id,...d.data()})))));
                unsubs.current.push(db.collection('events').doc(eid).collection('menu').onSnapshot(s => setMenu(s.docs.map(d => ({id:d.id,...d.data()})))));
                unsubs.current.push(db.collection('events').doc(eid).collection('orders').onSnapshot(s => setOrders(s.docs.map(d => ({id:d.id,...d.data()})))));
                unsubs.current.push(db.collection('events').doc(eid).collection('waiterCalls').where('status','==','pending').onSnapshot(s => setWaiterCalls(s.docs.map(d => ({id:d.id,...d.data()})))));
                unsubs.current.push(db.collection('events').doc(eid).collection('inventory').onSnapshot(s => setInventory(s.docs.map(d => ({id:d.id,...d.data()})))));
                unsubs.current.push(db.collection('events').doc(eid).collection('staff').onSnapshot(s => setStaff(s.docs.map(d => ({id:d.id,...d.data()})))));

                return () => unsubs.current.forEach(u => u());
            }, [currentEvent]);

            // Event functions
            const createEvent = async (name, date, venue) => {
                const id = Date.now().toString();
                await db.collection('events').doc(id).set({name, date, venue, createdAt: new Date().toISOString()});
                setCurrentEvent({id, name, date, venue});
                setShowNewEvent(false);
            };

            const deleteEvent = async (eid) => {
                if (!confirm('Eliminare questa serata?')) return;
                await db.collection('events').doc(eid).delete();
                if (currentEvent?.id === eid) setCurrentEvent(null);
            };

            // Table functions
            const addTable = async () => {
                const id = Date.now().toString();
                const table = {number: tables.length + 1, x: 100, y: 100, width: 80, height: 80, capacity: 8, shape: 'round'};
                await db.collection('events').doc(currentEvent.id).collection('tables').doc(id).set(table);
            };

            const updateTable = async (tid, data) => {
                await db.collection('events').doc(currentEvent.id).collection('tables').doc(tid).update(data);
            };

            const deleteTable = async (tid) => {
                await db.collection('events').doc(currentEvent.id).collection('tables').doc(tid).delete();
            };

            // Booking functions
            const addBooking = async (tableId, data) => {
                const id = Date.now().toString();
                await db.collection('events').doc(currentEvent.id).collection('bookings').doc(id).set({
                    tableId, ...data, status: 'confirmed', createdAt: new Date().toISOString()
                });
            };

            const deleteBooking = async (bid) => {
                await db.collection('events').doc(currentEvent.id).collection('bookings').doc(bid).delete();
            };

            // PR functions
            const addPr = async (name, phone) => {
                const id = Date.now().toString();
                await db.collection('events').doc(currentEvent.id).collection('prs').doc(id).set({name, phone, createdAt: new Date().toISOString()});
                setShowNewPr(false);
            };

            const deletePr = async (pid) => {
                if (!confirm('Eliminare questo PR?')) return;
                await db.collection('events').doc(currentEvent.id).collection('prs').doc(pid).delete();
                // Delete associated guests
                const guests = guestLists.filter(g => g.prId === pid);
                for (const g of guests) {
                    await db.collection('events').doc(currentEvent.id).collection('guestLists').doc(g.id).delete();
                }
            };

            // Guest functions
            const addGuest = async (prId, guestName, guestCount) => {
                const id = Date.now().toString();
                await db.collection('events').doc(currentEvent.id).collection('guestLists').doc(id).set({
                    prId, guestName, guestCount: guestCount || 1, checkedIn: false, createdAt: new Date().toISOString()
                });
            };

            const toggleGuestCheckIn = async (gid, current) => {
                await db.collection('events').doc(currentEvent.id).collection('guestLists').doc(gid).update({checkedIn: !current});
            };

            const deleteGuest = async (gid) => {
                await db.collection('events').doc(currentEvent.id).collection('guestLists').doc(gid).delete();
            };

            // Menu functions
            const addMenuItem = async (name, category, price) => {
                const id = Date.now().toString();
                await db.collection('events').doc(currentEvent.id).collection('menu').doc(id).set({name, category, price, createdAt: new Date().toISOString()});
            };

            const deleteMenuItem = async (mid) => {
                await db.collection('events').doc(currentEvent.id).collection('menu').doc(mid).delete();
            };

            // Waiter call functions
            const clearWaiterCall = async (cid) => {
                await db.collection('events').doc(currentEvent.id).collection('waiterCalls').doc(cid).update({status: 'completed'});
            };

            // Inventory functions
            const addInventoryItem = async (name, category, quantity, unitPrice) => {
                const id = Date.now().toString();
                await db.collection('events').doc(currentEvent.id).collection('inventory').doc(id).set({
                    name, category, quantity, unitPrice, initialStock: quantity, currentStock: quantity, manualConsumption: 0, createdAt: new Date().toISOString()
                });
            };

            const updateInventoryItem = async (iid, data) => {
                await db.collection('events').doc(currentEvent.id).collection('inventory').doc(iid).update(data);
            };

            const deleteInventoryItem = async (iid) => {
                await db.collection('events').doc(currentEvent.id).collection('inventory').doc(iid).delete();
            };

            // Staff functions
            const addStaffMember = async (name, role, phone, hourlyRate) => {
                const id = Date.now().toString();
                await db.collection('events').doc(currentEvent.id).collection('staff').doc(id).set({
                    name, role, phone, hourlyRate: hourlyRate || 0, status: 'off-duty', checkInTime: null, checkOutTime: null, createdAt: new Date().toISOString()
                });
            };

            const toggleStaffStatus = async (sid, current) => {
                const now = new Date().toISOString();
                const update = current === 'off-duty' ? {status: 'on-duty', checkInTime: now} : {status: 'off-duty', checkOutTime: now};
                await db.collection('events').doc(currentEvent.id).collection('staff').doc(sid).update(update);
            };

            const deleteStaffMember = async (sid) => {
                await db.collection('events').doc(currentEvent.id).collection('staff').doc(sid).delete();
            };

            // Helper functions
            const getTableBooking = (tid) => bookings.find(b => b.tableId === tid);
            const getTableOrders = (tid) => orders.filter(o => o.tableId === tid);
            const getTableTotal = (tid) => getTableOrders(tid).reduce((s,o) => s + (o.total||0), 0);
            const getTotalRevenue = () => orders.reduce((s,o) => s + (o.total||0), 0);
            const getPrStats = (pid) => {
                const prGuests = guestLists.filter(g => g.prId === pid);
                const prBookings = bookings.filter(b => b.prId === pid);
                return {
                    guestListCount: prGuests.reduce((s,g) => s + (g.guestCount||1), 0),
                    checkedInCount: prGuests.filter(g => g.checkedIn).length,
                    tableBookings: prBookings.length
                };
            };

            // Loading screen
            if (loading) {
                return h('div', {className: 'min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center'},
                    h('div', {className: 'text-center'},
                        h('div', {className: 'animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-purple-500 mx-auto mb-4'}),
                        h('p', {className: 'text-purple-300'}, 'Caricamento...')
                    )
                );
            }

            // Event selection screen
            if (!currentEvent) {
                return h('div', {className: 'min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-8'},
                    h('div', {className: 'max-w-4xl mx-auto'},
                        h('h1', {className: 'text-4xl font-black text-center mb-8 text-transparent bg-clip-text bg-gradient-to-r from-pink-400 to-cyan-400'}, '@_muse.in_'),
                        h('div', {className: 'flex justify-between items-center mb-6'},
                            h('h2', {className: 'text-2xl font-bold text-white'}, 'Le tue Serate'),
                            h('button', {
                                className: 'bg-gradient-to-r from-pink-500 to-purple-600 text-white px-6 py-3 rounded-lg font-bold flex items-center gap-2',
                                onClick: () => setShowNewEvent(true)
                            }, PlusIcon(20), ' Nuova Serata')
                        ),
                        h('div', {className: 'grid gap-4'},
                            events.map(ev => 
                                h('div', {key: ev.id, className: 'bg-slate-800/50 border border-purple-500/30 rounded-xl p-6 flex justify-between items-center cursor-pointer hover:border-purple-400', onClick: () => setCurrentEvent(ev)},
                                    h('div', {},
                                        h('h3', {className: 'text-xl font-bold text-white'}, ev.name),
                                        h('p', {className: 'text-purple-300'}, ev.date ? new Date(ev.date).toLocaleDateString('it-IT') : '', ' â€¢ ', ev.venue)
                                    ),
                                    h('button', {className: 'text-red-400 hover:text-red-300 p-2', onClick: (e) => {e.stopPropagation(); deleteEvent(ev.id);}}, TrashIcon(20))
                                )
                            ),
                            events.length === 0 && h('div', {className: 'text-center py-16 text-purple-300'}, 'Nessuna serata. Creane una nuova!')
                        ),
                        // New Event Modal
                        showNewEvent && h('div', {className: 'fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4'},
                            h('div', {className: 'bg-slate-800 border border-purple-500/30 rounded-xl p-8 max-w-md w-full'},
                                h('div', {className: 'flex justify-between items-center mb-6'},
                                    h('h2', {className: 'text-2xl font-bold text-white'}, 'Nuova Serata'),
                                    h('button', {className: 'text-purple-300', onClick: () => setShowNewEvent(false)}, XIcon(24))
                                ),
                                h('form', {onSubmit: (e) => {e.preventDefault(); const f = e.target; createEvent(f.name.value, f.date.value, f.venue.value);}},
                                    h('div', {className: 'space-y-4'},
                                        h('input', {name: 'name', required: true, placeholder: 'Nome evento', className: 'w-full bg-slate-900 border border-purple-500/30 rounded-lg px-4 py-3 text-white'}),
                                        h('input', {name: 'date', type: 'date', required: true, className: 'w-full bg-slate-900 border border-purple-500/30 rounded-lg px-4 py-3 text-white'}),
                                        h('input', {name: 'venue', required: true, placeholder: 'Location', className: 'w-full bg-slate-900 border border-purple-500/30 rounded-lg px-4 py-3 text-white'}),
                                        h('button', {type: 'submit', className: 'w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-bold'}, 'Crea Serata')
                                    )
                                )
                            )
                        )
                    )
                );
            }

            // Main event view
            return h('div', {className: 'min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-4 md:p-8'},
                h('div', {className: 'max-w-7xl mx-auto'},
                    // Header
                    h('header', {className: 'mb-8 flex flex-col md:flex-row justify-between items-start md:items-center gap-4'},
                        h('div', {className: 'flex items-center gap-4'},
                            h('button', {className: 'text-purple-300 hover:text-white', onClick: () => setCurrentEvent(null)}, ChevronLeftIcon(32)),
                            h('div', {},
                                h('h1', {className: 'text-2xl md:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-pink-400 to-cyan-400'}, currentEvent.name),
                                h('p', {className: 'text-purple-300'}, currentEvent.date ? new Date(currentEvent.date).toLocaleDateString('it-IT') : '', ' â€¢ ', currentEvent.venue)
                            )
                        ),
                        // Navigation tabs
                        h('div', {className: 'flex flex-wrap gap-2'},
                            ['tables', 'prs', 'orders', 'inventory', 'staff'].map(v =>
                                h('button', {
                                    key: v,
                                    className: `px-4 py-2 rounded-lg font-bold text-sm ${view === v ? 'bg-purple-600 text-white' : 'bg-slate-700 text-purple-300'}`,
                                    onClick: () => setView(v)
                                }, v === 'tables' ? 'ðŸª‘ Tavoli' : v === 'prs' ? 'ðŸ‘¥ PR' : v === 'orders' ? 'ðŸ¾ Ordini' : v === 'inventory' ? 'ðŸ“¦ Magazzino' : 'ðŸ‘¤ Staff')
                            )
                        )
                    ),

                    // Stats
                    h('div', {className: 'grid grid-cols-2 md:grid-cols-5 gap-4 mb-8'},
                        [{l:'Tavoli',v:tables.length,c:'from-purple-500 to-pink-500'},
                         {l:'Prenotazioni',v:bookings.length,c:'from-cyan-500 to-blue-500'},
                         {l:'PR',v:prs.length,c:'from-pink-500 to-orange-500'},
                         {l:'Ospiti',v:bookings.reduce((s,b)=>s+(b.guestCount||0),0)+guestLists.reduce((s,g)=>s+(g.guestCount||1),0),c:'from-green-500 to-emerald-500'},
                         {l:'Fatturato',v:'â‚¬'+getTotalRevenue().toFixed(0),c:'from-yellow-500 to-orange-500'}
                        ].map((s,i) => h('div', {key:i, className:`bg-gradient-to-r ${s.c} rounded-xl p-4 text-center`},
                            h('div', {className: 'text-white/80 text-sm'}, s.l),
                            h('div', {className: 'text-white text-2xl font-black'}, s.v)
                        ))
                    ),

                    // TABLES VIEW
                    view === 'tables' && h('div', {},
                        h('div', {className: 'flex justify-between items-center mb-4'},
                            h('h2', {className: 'text-xl font-bold text-white'}, 'Gestione Tavoli'),
                            h('button', {className: 'bg-gradient-to-r from-pink-500 to-purple-600 text-white px-4 py-2 rounded-lg font-bold flex items-center gap-2', onClick: addTable}, PlusIcon(18), ' Aggiungi Tavolo')
                        ),
                        h('div', {className: 'grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4'},
                            tables.sort((a,b) => a.number - b.number).map(table => {
                                const booking = getTableBooking(table.id);
                                const total = getTableTotal(table.id);
                                return h('div', {
                                    key: table.id,
                                    className: `rounded-xl p-4 border-2 cursor-pointer transition-all ${booking ? 'bg-green-500/20 border-green-500' : 'bg-slate-800/50 border-purple-500/30 hover:border-purple-400'}`,
                                    onClick: () => setSelectedTable(table)
                                },
                                    h('div', {className: 'text-center'},
                                        h('div', {className: 'text-2xl font-black text-white'}, table.number),
                                        h('div', {className: 'text-purple-300 text-sm'}, table.capacity, ' posti'),
                                        booking && h('div', {className: 'text-green-300 text-xs mt-1'}, booking.guestName),
                                        total > 0 && h('div', {className: 'text-yellow-400 text-sm font-bold mt-1'}, 'â‚¬', total.toFixed(0))
                                    ),
                                    h('button', {className: 'text-red-400 text-xs mt-2 w-full', onClick: (e) => {e.stopPropagation(); deleteTable(table.id);}}, 'Elimina')
                                );
                            })
                        ),
                        // Links section
                        h('div', {className: 'mt-8 bg-slate-800/50 border border-purple-500/30 rounded-xl p-6'},
                            h('h3', {className: 'text-lg font-bold text-white mb-4'}, 'Link per i Tavoli'),
                            h('p', {className: 'text-purple-300 text-sm mb-4'}, 'Copia il link e condividilo con i clienti al tavolo'),
                            h('div', {className: 'space-y-2 max-h-64 overflow-y-auto'},
                                tables.map(t => h('div', {key: t.id, className: 'flex justify-between items-center bg-slate-900/50 p-3 rounded-lg'},
                                    h('span', {className: 'text-white'}, 'Tavolo ', t.number),
                                    h('button', {
                                        className: 'text-cyan-400 text-sm bg-cyan-500/10 px-3 py-1 rounded',
                                        onClick: () => {
                                            const base = window.location.origin + window.location.pathname.replace(/[^/]*$/, '');
                                            const link = base + 'client-orders.html?event=' + currentEvent.id + '&table=' + t.id;
                                            navigator.clipboard.writeText(link);
                                            alert('Link copiato!\\n' + link);
                                        }
                                    }, 'ðŸ”— Copia Link')
                                ))
                            )
                        ),
                        // Selected table modal
                        selectedTable && h('div', {className: 'fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4'},
                            h('div', {className: 'bg-slate-800 border border-purple-500/30 rounded-xl p-6 max-w-md w-full'},
                                h('div', {className: 'flex justify-between items-center mb-4'},
                                    h('h2', {className: 'text-xl font-bold text-white'}, 'Tavolo ', selectedTable.number),
                                    h('button', {className: 'text-purple-300', onClick: () => setSelectedTable(null)}, XIcon(24))
                                ),
                                (() => {
                                    const booking = getTableBooking(selectedTable.id);
                                    if (booking) {
                                        return h('div', {className: 'space-y-3'},
                                            h('p', {className: 'text-white'}, h('strong', {}, 'Ospite: '), booking.guestName),
                                            h('p', {className: 'text-purple-300'}, h('strong', {}, 'Persone: '), booking.guestCount),
                                            booking.phone && h('p', {className: 'text-purple-300'}, h('strong', {}, 'Tel: '), booking.phone),
                                            booking.notes && h('p', {className: 'text-purple-300'}, h('strong', {}, 'Note: '), booking.notes),
                                            h('button', {className: 'w-full bg-red-500 text-white py-2 rounded-lg mt-4', onClick: () => {deleteBooking(booking.id); setSelectedTable(null);}}, 'Rimuovi Prenotazione')
                                        );
                                    }
                                    return h('form', {onSubmit: (e) => {
                                        e.preventDefault();
                                        const f = e.target;
                                        addBooking(selectedTable.id, {
                                            guestName: f.guestName.value,
                                            guestCount: parseInt(f.guestCount.value),
                                            phone: f.phone.value,
                                            notes: f.notes.value,
                                            prId: f.prId.value || null,
                                            prName: prs.find(p => p.id === f.prId.value)?.name || null
                                        });
                                        setSelectedTable(null);
                                    }},
                                        h('div', {className: 'space-y-4'},
                                            h('input', {name: 'guestName', required: true, placeholder: 'Nome ospite', className: 'w-full bg-slate-900 border border-purple-500/30 rounded-lg px-4 py-3 text-white'}),
                                            h('input', {name: 'guestCount', type: 'number', min: 1, defaultValue: selectedTable.capacity, placeholder: 'Numero persone', className: 'w-full bg-slate-900 border border-purple-500/30 rounded-lg px-4 py-3 text-white'}),
                                            h('input', {name: 'phone', placeholder: 'Telefono (opz)', className: 'w-full bg-slate-900 border border-purple-500/30 rounded-lg px-4 py-3 text-white'}),
                                            h('select', {name: 'prId', className: 'w-full bg-slate-900 border border-purple-500/30 rounded-lg px-4 py-3 text-white'},
                                                h('option', {value: ''}, 'Nessun PR'),
                                                prs.map(p => h('option', {key: p.id, value: p.id}, p.name))
                                            ),
                                            h('textarea', {name: 'notes', placeholder: 'Note (opz)', className: 'w-full bg-slate-900 border border-purple-500/30 rounded-lg px-4 py-3 text-white', rows: 2}),
                                            h('button', {type: 'submit', className: 'w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-bold'}, 'Prenota Tavolo')
                                        )
                                    );
                                })()
                            )
                        )
                    ),

                    // PRS VIEW
                    view === 'prs' && h('div', {className: 'grid grid-cols-1 lg:grid-cols-3 gap-8'},
                        h('div', {className: 'lg:col-span-2'},
                            h('div', {className: 'flex justify-between items-center mb-4'},
                                h('h2', {className: 'text-xl font-bold text-white'}, 'PR / Promoter'),
                                h('div', {className: 'flex gap-2'},
                                    h('button', {className: 'bg-gradient-to-r from-cyan-500 to-blue-600 text-white px-4 py-2 rounded-lg font-bold flex items-center gap-2', onClick: () => setShowFullGuestList(true)}, 'ðŸ“‹ Lista Completa'),
                                    h('button', {className: 'bg-gradient-to-r from-pink-500 to-purple-600 text-white px-4 py-2 rounded-lg font-bold flex items-center gap-2', onClick: () => setShowNewPr(true)}, PlusIcon(18), ' Nuovo PR')
                                )
                            ),
                            h('div', {className: 'space-y-3'},
                                prs.map(pr => {
                                    const stats = getPrStats(pr.id);
                                    return h('div', {key: pr.id, className: 'bg-slate-800/50 border border-purple-500/30 rounded-xl p-4 cursor-pointer hover:border-purple-400', onClick: () => setSelectedPr(pr)},
                                        h('div', {className: 'flex justify-between items-start mb-3'},
                                            h('div', {},
                                                h('h3', {className: 'text-white font-bold text-lg'}, pr.name),
                                                pr.phone && h('p', {className: 'text-purple-300 text-sm'}, pr.phone)
                                            ),
                                            h('div', {className: 'flex gap-2'},
                                                h('button', {
                                                    className: 'text-cyan-400 text-sm bg-cyan-500/10 px-3 py-1 rounded',
                                                    onClick: (e) => {
                                                        e.stopPropagation();
                                                        const base = window.location.origin + window.location.pathname.replace(/[^/]*$/, '');
                                                        const link = base + 'pr-app.html?event=' + currentEvent.id + '&pr=' + pr.id;
                                                        navigator.clipboard.writeText(link);
                                                        alert('Link copiato!\\n' + link);
                                                    }
                                                }, 'ðŸ”— Link'),
                                                h('button', {className: 'text-red-400', onClick: (e) => {e.stopPropagation(); deletePr(pr.id);}}, TrashIcon(16))
                                            )
                                        ),
                                        h('div', {className: 'grid grid-cols-3 gap-2 text-center'},
                                            h('div', {className: 'bg-purple-500/20 rounded p-2'}, h('div', {className: 'text-xs text-purple-300'}, 'Lista'), h('div', {className: 'text-white font-bold'}, stats.guestListCount)),
                                            h('div', {className: 'bg-cyan-500/20 rounded p-2'}, h('div', {className: 'text-xs text-cyan-300'}, 'Tavoli'), h('div', {className: 'text-white font-bold'}, stats.tableBookings)),
                                            h('div', {className: 'bg-green-500/20 rounded p-2'}, h('div', {className: 'text-xs text-green-300'}, 'Check-in'), h('div', {className: 'text-white font-bold'}, stats.checkedInCount))
                                        )
                                    );
                                }),
                                prs.length === 0 && h('div', {className: 'text-center py-16 text-purple-300'}, 'Nessun PR. Aggiungine uno!')
                            )
                        ),
                        // Guest list panel
                        h('div', {className: 'bg-slate-800/50 border border-purple-500/30 rounded-xl p-6'},
                            h('h3', {className: 'text-lg font-bold text-white mb-4'}, selectedPr ? 'Lista ' + selectedPr.name : 'Seleziona un PR'),
                            selectedPr ? h('div', {},
                                h('button', {
                                    className: 'w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-2 rounded-lg mb-4 font-bold',
                                    onClick: () => {
                                        const name = prompt('Nome ospite:');
                                        if (!name) return;
                                        const count = parseInt(prompt('Numero persone:', '1')) || 1;
                                        addGuest(selectedPr.id, name, count);
                                    }
                                }, '+ Aggiungi Ospite'),
                                h('div', {className: 'space-y-2 max-h-96 overflow-y-auto'},
                                    guestLists.filter(g => g.prId === selectedPr.id).map(guest =>
                                        h('div', {key: guest.id, className: `rounded-lg p-3 border ${guest.checkedIn ? 'bg-green-500/20 border-green-400/40' : 'bg-slate-900/50 border-purple-500/20'}`},
                                            h('div', {className: 'flex justify-between items-center'},
                                                h('div', {},
                                                    h('div', {className: 'text-white font-medium'}, guest.guestName),
                                                    h('div', {className: 'text-purple-300 text-xs'}, guest.guestCount, ' ', guest.guestCount === 1 ? 'persona' : 'persone')
                                                ),
                                                h('div', {className: 'flex gap-2'},
                                                    h('button', {
                                                        className: `px-3 py-1 rounded text-xs ${guest.checkedIn ? 'bg-green-500 text-white' : 'bg-slate-700 text-purple-300'}`,
                                                        onClick: () => toggleGuestCheckIn(guest.id, guest.checkedIn)
                                                    }, guest.checkedIn ? 'âœ“' : 'Check-in'),
                                                    h('button', {className: 'text-red-400', onClick: () => deleteGuest(guest.id)}, XIcon(16))
                                                )
                                            )
                                        )
                                    ),
                                    guestLists.filter(g => g.prId === selectedPr.id).length === 0 && h('p', {className: 'text-purple-300 text-center py-8'}, 'Lista vuota')
                                )
                            ) : h('p', {className: 'text-purple-300 text-center py-8'}, 'Clicca su un PR per vedere la sua lista')
                        ),
                        // New PR Modal
                        showNewPr && h('div', {className: 'fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4'},
                            h('div', {className: 'bg-slate-800 border border-purple-500/30 rounded-xl p-6 max-w-md w-full'},
                                h('div', {className: 'flex justify-between items-center mb-4'},
                                    h('h2', {className: 'text-xl font-bold text-white'}, 'Nuovo PR'),
                                    h('button', {className: 'text-purple-300', onClick: () => setShowNewPr(false)}, XIcon(24))
                                ),
                                h('form', {onSubmit: (e) => {e.preventDefault(); addPr(e.target.name.value, e.target.phone.value);}},
                                    h('div', {className: 'space-y-4'},
                                        h('input', {name: 'name', required: true, placeholder: 'Nome PR', className: 'w-full bg-slate-900 border border-purple-500/30 rounded-lg px-4 py-3 text-white'}),
                                        h('input', {name: 'phone', placeholder: 'Telefono (opz)', className: 'w-full bg-slate-900 border border-purple-500/30 rounded-lg px-4 py-3 text-white'}),
                                        h('button', {type: 'submit', className: 'w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-bold'}, 'Crea PR')
                                    )
                                )
                            )
                        ),
                        // Full Guest List Modal
                        showFullGuestList && h('div', {className: 'fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4'},
                            h('div', {className: 'bg-slate-800 border border-purple-500/30 rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col'},
                                h('div', {className: 'flex justify-between items-center mb-4'},
                                    h('div', {},
                                        h('h2', {className: 'text-xl font-bold text-white'}, 'ðŸ“‹ Lista Completa Ospiti'),
                                        h('p', {className: 'text-purple-300 text-sm'}, guestLists.length, ' ospiti totali â€¢ ', guestLists.filter(g => g.checkedIn).length, ' check-in')
                                    ),
                                    h('button', {className: 'text-purple-300', onClick: () => setShowFullGuestList(false)}, XIcon(24))
                                ),
                                h('div', {className: 'flex gap-2 mb-4'},
                                    h('div', {className: 'bg-green-500/20 text-green-300 px-3 py-1 rounded-full text-sm'}, 'âœ“ Check-in: ', guestLists.filter(g => g.checkedIn).length),
                                    h('div', {className: 'bg-yellow-500/20 text-yellow-300 px-3 py-1 rounded-full text-sm'}, 'â³ In attesa: ', guestLists.filter(g => !g.checkedIn).length),
                                    h('div', {className: 'bg-purple-500/20 text-purple-300 px-3 py-1 rounded-full text-sm'}, 'ðŸ‘¥ Persone: ', guestLists.reduce((sum, g) => sum + (g.guestCount || 1), 0))
                                ),
                                h('div', {className: 'overflow-y-auto flex-1'},
                                    h('table', {className: 'w-full'},
                                        h('thead', {className: 'bg-slate-900/50 sticky top-0'},
                                            h('tr', {},
                                                h('th', {className: 'text-left text-purple-300 text-sm font-bold px-3 py-2'}, 'Ospite'),
                                                h('th', {className: 'text-left text-purple-300 text-sm font-bold px-3 py-2'}, 'PR'),
                                                h('th', {className: 'text-center text-purple-300 text-sm font-bold px-3 py-2'}, 'Persone'),
                                                h('th', {className: 'text-center text-purple-300 text-sm font-bold px-3 py-2'}, 'Stato')
                                            )
                                        ),
                                        h('tbody', {},
                                            guestLists.sort((a, b) => {
                                                if (a.checkedIn !== b.checkedIn) return a.checkedIn ? 1 : -1;
                                                return (a.guestName || '').localeCompare(b.guestName || '');
                                            }).map(guest => {
                                                const pr = prs.find(p => p.id === guest.prId);
                                                return h('tr', {key: guest.id, className: 'border-b border-slate-700/50 ' + (guest.checkedIn ? 'opacity-60' : '')},
                                                    h('td', {className: 'px-3 py-3'},
                                                        h('span', {className: 'text-white font-medium'}, guest.guestName)
                                                    ),
                                                    h('td', {className: 'px-3 py-3'},
                                                        h('span', {className: 'text-purple-300 text-sm'}, pr ? pr.name : '-')
                                                    ),
                                                    h('td', {className: 'px-3 py-3 text-center'},
                                                        h('span', {className: 'text-cyan-300'}, guest.guestCount || 1)
                                                    ),
                                                    h('td', {className: 'px-3 py-3 text-center'},
                                                        guest.checkedIn 
                                                            ? h('span', {className: 'bg-green-500/20 text-green-300 px-2 py-1 rounded-full text-xs'}, 'âœ“ Arrivato')
                                                            : h('span', {className: 'bg-yellow-500/20 text-yellow-300 px-2 py-1 rounded-full text-xs'}, 'â³ Atteso')
                                                    )
                                                );
                                            })
                                        )
                                    ),
                                    guestLists.length === 0 && h('p', {className: 'text-purple-300 text-center py-8'}, 'Nessun ospite nelle liste')
                                )
                            )
                        )
                    ),

                    // ORDERS VIEW
                    view === 'orders' && h('div', {className: 'grid grid-cols-1 lg:grid-cols-3 gap-8'},
                        h('div', {className: 'lg:col-span-2'},
                            // Menu section
                            h('div', {className: 'bg-slate-800/50 border border-purple-500/30 rounded-xl p-6 mb-6'},
                                h('div', {className: 'flex justify-between items-center mb-4'},
                                    h('h2', {className: 'text-xl font-bold text-white'}, 'Menu'),
                                    h('button', {
                                        className: 'bg-gradient-to-r from-pink-500 to-purple-600 text-white px-4 py-2 rounded-lg font-bold text-sm',
                                        onClick: () => {
                                            const name = prompt('Nome prodotto:');
                                            if (!name) return;
                                            const category = prompt('Categoria (es: Bottiglie, Cocktail):');
                                            if (!category) return;
                                            const price = parseFloat(prompt('Prezzo â‚¬:'));
                                            if (isNaN(price)) return;
                                            addMenuItem(name, category, price);
                                        }
                                    }, '+ Aggiungi')
                                ),
                                h('div', {className: 'space-y-2 max-h-64 overflow-y-auto'},
                                    menu.map(item => h('div', {key: item.id, className: 'flex justify-between items-center bg-slate-900/50 p-3 rounded-lg'},
                                        h('div', {}, h('span', {className: 'text-white font-bold'}, item.name), h('span', {className: 'text-purple-300 text-sm ml-2'}, '(', item.category, ')')),
                                        h('div', {className: 'flex items-center gap-3'},
                                            h('span', {className: 'text-green-400 font-bold'}, 'â‚¬', item.price?.toFixed(2)),
                                            h('button', {className: 'text-red-400', onClick: () => deleteMenuItem(item.id)}, XIcon(16))
                                        )
                                    )),
                                    menu.length === 0 && h('p', {className: 'text-purple-300 text-center py-8'}, 'Menu vuoto')
                                )
                            ),
                            // Waiter calls
                            h('div', {className: 'bg-slate-800/50 border border-purple-500/30 rounded-xl p-6 mb-6'},
                                h('h2', {className: 'text-xl font-bold text-white mb-4'}, 'ðŸ”” Chiamate Cameriere ', waiterCalls.length > 0 && h('span', {className: 'bg-orange-500 text-white text-sm px-2 py-1 rounded-full ml-2'}, waiterCalls.length)),
                                h('div', {className: 'space-y-2'},
                                    waiterCalls.map(call => h('div', {key: call.id, className: 'bg-orange-500/20 border border-orange-400/50 rounded-lg p-4 flex justify-between items-center'},
                                        h('div', {},
                                            h('div', {className: 'text-white font-bold text-lg'}, 'Tavolo ', call.tableNumber),
                                            h('div', {className: 'text-orange-300 text-sm'}, new Date(call.createdAt).toLocaleTimeString('it-IT'))
                                        ),
                                        h('button', {className: 'bg-green-500 text-white px-4 py-2 rounded-lg font-bold', onClick: () => clearWaiterCall(call.id)}, 'âœ“ Servito')
                                    )),
                                    waiterCalls.length === 0 && h('p', {className: 'text-purple-300 text-center py-4'}, 'Nessuna chiamata')
                                )
                            ),
                            // Orders list
                            h('div', {className: 'bg-slate-800/50 border border-purple-500/30 rounded-xl p-6'},
                                h('h2', {className: 'text-xl font-bold text-white mb-4'}, 'Ordini'),
                                h('div', {className: 'space-y-3 max-h-96 overflow-y-auto'},
                                    tables.map(table => {
                                        const tableOrders = getTableOrders(table.id);
                                        if (tableOrders.length === 0) return null;
                                        return h('div', {key: table.id, className: 'bg-slate-900/50 rounded-lg p-4 border border-purple-500/20'},
                                            h('div', {className: 'flex justify-between items-start mb-2'},
                                                h('div', {}, h('h3', {className: 'text-white font-bold'}, 'Tavolo ', table.number), h('p', {className: 'text-purple-300 text-sm'}, tableOrders.length, ' ordini')),
                                                h('div', {className: 'text-yellow-400 font-bold text-lg'}, 'â‚¬', getTableTotal(table.id).toFixed(2))
                                            ),
                                            h('div', {className: 'space-y-1 text-sm text-purple-200'},
                                                tableOrders.map(o => h('div', {key: o.id, className: 'flex justify-between'}, h('span', {}, o.quantity, 'x ', o.productName), h('span', {}, 'â‚¬', o.total?.toFixed(2))))
                                            )
                                        );
                                    }),
                                    orders.length === 0 && h('p', {className: 'text-purple-300 text-center py-8'}, 'Nessun ordine')
                                )
                            )
                        ),
                        // Sidebar vuota - i link staff sono nella sezione Staff
                        h('div', {})
                    ),

                    // INVENTORY VIEW
                    view === 'inventory' && h('div', {className: 'grid grid-cols-1 lg:grid-cols-3 gap-8'},
                        h('div', {className: 'lg:col-span-2'},
                            h('div', {className: 'flex justify-between items-center mb-4'},
                                h('h2', {className: 'text-xl font-bold text-white'}, 'ðŸ“¦ Magazzino'),
                                h('button', {
                                    className: 'bg-gradient-to-r from-amber-500 to-orange-600 text-white px-4 py-2 rounded-lg font-bold text-sm',
                                    onClick: () => {
                                        const name = prompt('Nome prodotto:');
                                        if (!name) return;
                                        const category = prompt('Categoria:');
                                        if (!category) return;
                                        const quantity = parseInt(prompt('QuantitÃ :'));
                                        if (isNaN(quantity)) return;
                                        const price = parseFloat(prompt('Prezzo unitario â‚¬:'));
                                        if (isNaN(price)) return;
                                        addInventoryItem(name, category, quantity, price);
                                    }
                                }, '+ Aggiungi')
                            ),
                            h('div', {className: 'space-y-3'},
                                inventory.map(item => h('div', {key: item.id, className: 'bg-slate-800/50 border border-purple-500/30 rounded-xl p-4'},
                                    h('div', {className: 'flex justify-between items-start mb-3'},
                                        h('div', {},
                                            h('h3', {className: 'text-white font-bold text-lg'}, item.name),
                                            h('p', {className: 'text-purple-300 text-sm'}, item.category, ' â€¢ â‚¬', item.unitPrice, '/pz')
                                        ),
                                        h('button', {className: 'text-red-400', onClick: () => deleteInventoryItem(item.id)}, TrashIcon(16))
                                    ),
                                    h('div', {className: 'grid grid-cols-3 gap-2 mb-3'},
                                        h('div', {className: 'bg-slate-900/50 rounded p-2 text-center'}, h('div', {className: 'text-purple-300 text-xs'}, 'Iniziale'), h('div', {className: 'text-white font-bold'}, item.initialStock)),
                                        h('div', {className: 'bg-orange-500/20 rounded p-2 text-center'}, h('div', {className: 'text-orange-300 text-xs'}, 'Manuale'), h('div', {className: 'text-white font-bold'}, item.manualConsumption || 0)),
                                        h('div', {className: 'bg-green-500/20 rounded p-2 text-center'}, h('div', {className: 'text-green-300 text-xs'}, 'Rimaste'), h('div', {className: 'text-white font-bold'}, (item.initialStock || 0) - (item.manualConsumption || 0)))
                                    ),
                                    h('div', {className: 'flex items-center justify-between bg-slate-900/30 rounded-lg p-2'},
                                        h('span', {className: 'text-purple-300 text-sm'}, 'Consumo manuale:'),
                                        h('div', {className: 'flex items-center gap-2'},
                                            h('button', {className: 'bg-slate-700 text-white w-8 h-8 rounded', onClick: () => updateInventoryItem(item.id, {manualConsumption: Math.max(0, (item.manualConsumption||0) - 1)})}, '-'),
                                            h('span', {className: 'text-white font-bold w-8 text-center'}, item.manualConsumption || 0),
                                            h('button', {className: 'bg-slate-700 text-white w-8 h-8 rounded', onClick: () => updateInventoryItem(item.id, {manualConsumption: (item.manualConsumption||0) + 1})}, '+')
                                        )
                                    )
                                )),
                                inventory.length === 0 && h('p', {className: 'text-purple-300 text-center py-16'}, 'Magazzino vuoto')
                            )
                        ),
                        h('div', {className: 'bg-slate-800/50 border border-purple-500/30 rounded-xl p-6'},
                            h('h3', {className: 'text-lg font-bold text-white mb-4'}, 'Riepilogo'),
                            h('div', {className: 'space-y-3'},
                                h('div', {className: 'flex justify-between'}, h('span', {className: 'text-purple-300'}, 'Prodotti'), h('span', {className: 'text-white font-bold'}, inventory.length)),
                                h('div', {className: 'flex justify-between'}, h('span', {className: 'text-purple-300'}, 'Valore stock'), h('span', {className: 'text-white font-bold'}, 'â‚¬', inventory.reduce((s,i) => s + ((i.initialStock||0) - (i.manualConsumption||0)) * (i.unitPrice||0), 0).toFixed(0)))
                            )
                        )
                    ),

                    // STAFF VIEW
                    view === 'staff' && h('div', {className: 'grid grid-cols-1 lg:grid-cols-3 gap-8'},
                        h('div', {className: 'lg:col-span-2'},
                            h('div', {className: 'flex justify-between items-center mb-4'},
                                h('h2', {className: 'text-xl font-bold text-white'}, 'ðŸ‘¤ Staff'),
                                h('button', {
                                    className: 'bg-gradient-to-r from-emerald-500 to-green-600 text-white px-4 py-2 rounded-lg font-bold text-sm',
                                    onClick: () => {
                                        const name = prompt('Nome:');
                                        if (!name) return;
                                        const role = prompt('Ruolo (es: Cameriere, Barista, Sicurezza):');
                                        if (!role) return;
                                        const phone = prompt('Telefono (opz):') || '';
                                        const rate = parseFloat(prompt('Paga oraria â‚¬ (opz):') || '0');
                                        addStaffMember(name, role, phone, rate);
                                    }
                                }, '+ Aggiungi')
                            ),
                            h('div', {className: 'space-y-3'},
                                staff.map(member => {
                                    const isOn = member.status === 'on-duty';
                                    const isWaiter = member.role && (member.role.toLowerCase() === 'cameriere' || member.role.toLowerCase() === 'cameriera');
                                    let hours = 0;
                                    if (member.checkInTime) {
                                        const checkIn = new Date(member.checkInTime);
                                        const checkOut = member.checkOutTime ? new Date(member.checkOutTime) : new Date();
                                        hours = (checkOut - checkIn) / (1000 * 60 * 60);
                                    }
                                    return h('div', {key: member.id, className: `rounded-xl p-4 border ${isOn ? 'bg-green-500/10 border-green-400/40' : 'bg-slate-800/50 border-purple-500/30'}`},
                                        h('div', {className: 'flex justify-between items-start mb-3'},
                                            h('div', {className: 'flex items-start gap-3'},
                                                h('div', {className: `w-3 h-3 rounded-full mt-2 ${isOn ? 'bg-green-400' : 'bg-slate-500'}`}),
                                                h('div', {},
                                                    h('h3', {className: 'text-white font-bold text-lg'}, member.name),
                                                    h('p', {className: 'text-purple-300 text-sm'}, member.role, isWaiter ? ' ðŸ½ï¸' : ''),
                                                    member.phone && h('p', {className: 'text-purple-400 text-xs'}, member.phone)
                                                )
                                            ),
                                            h('div', {className: 'flex gap-2'},
                                                h('button', {
                                                    className: 'text-cyan-400 bg-cyan-500/10 px-2 py-1 rounded text-xs',
                                                    onClick: () => {
                                                        const base = window.location.origin + window.location.pathname.replace(/[^/]*$/, '');
                                                        const link = base + 'staff-app.html?event=' + currentEvent.id + '&staff=' + member.id;
                                                        navigator.clipboard.writeText(link);
                                                        alert('Link copiato per ' + member.name + '!\\n\\n' + link);
                                                    }
                                                }, 'ðŸ”— Link'),
                                                h('button', {className: 'text-red-400', onClick: () => deleteStaffMember(member.id)}, TrashIcon(16))
                                            )
                                        ),
                                        h('div', {className: 'grid grid-cols-3 gap-2 mb-3'},
                                            h('div', {className: 'bg-slate-900/50 rounded p-2 text-center'}, h('div', {className: 'text-purple-300 text-xs'}, 'Check-in'), h('div', {className: 'text-white text-sm'}, member.checkInTime ? new Date(member.checkInTime).toLocaleTimeString('it-IT', {hour:'2-digit',minute:'2-digit'}) : '-')),
                                            h('div', {className: 'bg-slate-900/50 rounded p-2 text-center'}, h('div', {className: 'text-purple-300 text-xs'}, 'Check-out'), h('div', {className: 'text-white text-sm'}, member.checkOutTime ? new Date(member.checkOutTime).toLocaleTimeString('it-IT', {hour:'2-digit',minute:'2-digit'}) : isOn ? 'In corso' : '-')),
                                            h('div', {className: 'bg-slate-900/50 rounded p-2 text-center'}, h('div', {className: 'text-purple-300 text-xs'}, 'Ore'), h('div', {className: 'text-white text-sm'}, hours > 0 ? hours.toFixed(1) + 'h' : '-'))
                                        ),
                                        h('button', {
                                            className: `w-full py-2 rounded-lg font-bold ${isOn ? 'bg-red-500/20 text-red-300 border border-red-500/30' : 'bg-green-500/20 text-green-300 border border-green-500/30'}`,
                                            onClick: () => toggleStaffStatus(member.id, member.status)
                                        }, isOn ? 'â¹ Check-out' : 'â–¶ Check-in')
                                    );
                                }),
                                staff.length === 0 && h('p', {className: 'text-purple-300 text-center py-16'}, 'Nessuno staff. Aggiungi camerieri, baristi, sicurezza...')
                            )
                        ),
                        h('div', {className: 'space-y-6'},
                            h('div', {className: 'bg-slate-800/50 border border-purple-500/30 rounded-xl p-6'},
                                h('h3', {className: 'text-lg font-bold text-white mb-4'}, 'Riepilogo'),
                                h('div', {className: 'space-y-3'},
                                    h('div', {className: 'flex justify-between'}, h('span', {className: 'text-purple-300'}, 'Totale'), h('span', {className: 'text-white font-bold'}, staff.length)),
                                    h('div', {className: 'flex justify-between'}, h('span', {className: 'text-purple-300'}, 'In servizio'), h('span', {className: 'text-green-400 font-bold'}, staff.filter(s => s.status === 'on-duty').length)),
                                    h('div', {className: 'flex justify-between'}, h('span', {className: 'text-purple-300'}, 'Camerieri'), h('span', {className: 'text-cyan-400 font-bold'}, staff.filter(s => s.role && (s.role.toLowerCase() === 'cameriere' || s.role.toLowerCase() === 'cameriera')).length)),
                                    h('div', {className: 'flex justify-between'}, h('span', {className: 'text-purple-300'}, 'Costo totale'), h('span', {className: 'text-yellow-400 font-bold'}, 'â‚¬', staff.reduce((sum, m) => {
                                        if (!m.hourlyRate || !m.checkInTime) return sum;
                                        const checkIn = new Date(m.checkInTime);
                                        const checkOut = m.checkOutTime ? new Date(m.checkOutTime) : new Date();
                                        const hours = (checkOut - checkIn) / (1000 * 60 * 60);
                                        return sum + (hours * m.hourlyRate);
                                    }, 0).toFixed(0)))
                                )
                            ),
                            h('div', {className: 'bg-slate-800/50 border border-purple-500/30 rounded-xl p-6'},
                                h('h3', {className: 'text-lg font-bold text-white mb-3'}, 'ðŸ“· QR Check-in Serata'),
                                h('p', {className: 'text-purple-300 text-sm mb-4'}, 'Genera il QR da mostrare allo staff per timbrare'),
                                h('button', {
                                    className: 'w-full bg-gradient-to-r from-purple-500 to-pink-600 text-white py-3 rounded-lg font-bold',
                                    onClick: () => {
                                        const base = window.location.origin + window.location.pathname.replace(/[^/]*$/, '');
                                        const link = base + 'event-qr.html?event=' + currentEvent.id;
                                        window.open(link, '_blank');
                                    }
                                }, 'ðŸ“± Mostra QR Serata')
                            ),
                            h('div', {className: 'bg-slate-800/50 border border-purple-500/30 rounded-xl p-6'},
                                h('h3', {className: 'text-lg font-bold text-white mb-3'}, 'ðŸ’¡ Come funziona'),
                                h('div', {className: 'text-purple-300 text-sm space-y-2'},
                                    h('p', {}, '1. Aggiungi lo staff con nome e ruolo'),
                                    h('p', {}, '2. Clicca "ðŸ”— Link" per copiare il link personale'),
                                    h('p', {}, '3. Invia il link al membro dello staff'),
                                    h('p', {}, '4. Lo staff scansiona il QR serata per check-in/out'),
                                    h('p', {}, '5. I ', h('strong', {}, 'Camerieri'), ' vedono anche ordini e chiamate')
                                )
                            )
                        )
                    )
                )
            );
        }

        ReactDOM.render(h(App), document.getElementById('root'));
    </script>
</body>
</html>
